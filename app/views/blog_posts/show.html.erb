<% content_for :title, @blog_post.title %>

<div class="mx-auto mt-8" style="max-width: 896px;">

  <!-- Blog Banner -->
  <% if @blog_post.banner_image.attached? %>
    <div class="mb-6 rounded-xl overflow-hidden shadow-sm">
      <% if defined?(ImageProcessing) %>
        <%= image_tag @blog_post.banner_image.variant(resize_to_limit: [1200, 600]),
            alt: @blog_post.title, class: "w-full object-cover", style: "max-height: 400px;"  %>
      <% else %>
        <%= image_tag @blog_post.banner_image,
            alt: @blog_post.title, class: "w-full object-cover", style: "max-height: 400px;" %>
      <% end %>
    </div>
  <% end %>

  <!-- Title & Date -->
  <h1 class="text-4xl font-bold mb-2"><%= @blog_post.title %></h1>
  <p class="text-gray-500 text-sm mb-1">
    <%= @blog_post.user&.username || "Unknown author" %>
  </p>
  <p class="text-gray-500 text-sm mb-8">
    <%= @blog_post.created_at.strftime("%B %d, %Y") %>
  </p>

  <!-- Blog Body -->
  <div class="prose prose-lg max-w-none mb-12">
    <%= @blog_post.body %>
  </div>

  <!-- Actions -->
  <div class="flex justify-between items-center mb-12">

    <!-- Left side: Edit/Delete -->
    <% if @blog_post.user == current_user %>
      <div class="flex gap-3">
        <%= link_to "Edit",
            edit_blog_post_path(@blog_post),
            class: "px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-500 text-sm font-medium shadow-sm" %>

        <%= button_to "Delete",
            @blog_post,
            method: :delete,
            data: { turbo_confirm: "Are you sure?" },
            class: "px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm font-medium shadow-sm cursor-pointer" %>
      </div>
    <% end %>

    <!-- Right side: Back -->
    <div>
      <%= link_to "Back",
          blog_posts_path,
          class: "px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-sm font-medium shadow-sm" %>
    </div>

  </div>


  <!-- Comments Section -->
  <div class="mt-16">

    <h2 class="text-2xl font-bold mb-6">
      Comments (<%= (@comments || @blog_post.comments.where.not(id: nil)).count %>)
    </h2>

    <% comments_to_render = @comments || @blog_post.comments.where.not(id: nil) %>

    <% if comments_to_render.any? %>
      <div class="space-y-5 mb-12">
        <%= render comments_to_render %>
      </div>
    <% else %>
      <p class="text-gray-500 italic mb-12">No comments yet. Be the first to comment!</p>
    <% end %>

    <!-- Add Comment Form Card -->
    <div class="bg-white p-5 rounded-xl shadow border border-gray-200">
      <h3 class="text-xl font-semibold mb-4">Add a Comment</h3>

      <% if @comment&.errors&.any? %>
        <div class="mb-4 p-3 bg-red-50 border border-red-100 rounded">
          <ul class="text-sm text-red-700">
            <% @comment.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%= render "comments/form",
        blog_post: @blog_post,
        comment: @comment
      %>
    </div>

  </div>
          
</div>
